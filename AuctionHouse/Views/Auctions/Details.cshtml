@model AuctionHouse.Models.ViewModels.AuctionVm
@{
    var ongoing = Model.EndsAt > DateTime.Now;
}
<h3>@Model.Title</h3>
<p>@Model.Description</p>
<p><b>Ends:</b> @Model.EndsAt:u &nbsp; <b>Start:</b> @Model.StartPrice:0.00</p>

@if (TempData["BidError"] is string err)
{
    <div class="alert alert-danger">@err</div>
}

<h4>Bids</h4>
@if (!Model.Bids.Any())
{
    <p>No bids yet.</p>
}
else
{
    <table class="table table-sm">
        <thead><tr><th>Amount</th><th>Bidder</th><th>Placed</th></tr></thead>
        <tbody>
        @foreach (var b in Model.Bids)
        {
            <tr><td>@b.Amount:0.00</td><td>@b.BidderId</td><td>@b.PlacedAtUtc:u</td></tr>
        }
        </tbody>
    </table>
}

@if (ongoing && (User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value ?? "demo-user") != Model.SellerId)
{
    <form method="post" asp-controller="Bids" asp-action="Place" class="mt-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="auctionId" value="@Model.Id" />
        <div class="input-group">
            <input name="amount" type="number" step="0.01" min="0.01" class="form-control" placeholder="Your bid" />
            <button class="btn btn-success">Bid</button>
        </div>
    </form>
}

<h5 class="mt-4">Edit description</h5>
<form method="post" asp-action="EditDescription">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" value="@Model.Id" />
    <div class="input-group">
        <input name="description" class="form-control" placeholder="New description" />
        <button class="btn btn-warning">Save</button>
    </div>
</form>